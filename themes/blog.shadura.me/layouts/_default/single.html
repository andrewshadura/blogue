{{ define "htmlscope" }} itemscope itemtype="http://schema.org/BlogPosting" class="h-entry"{{ end }}

{{ define "title" }}{{ if .Title }}{{ .Title | plainify }} &mdash; {{ end }}{{ .Site.Title }}{{ end }}

{{ define "head" }}
{{ partial "head.html" . }}

{{- /* Auto-select cover image: 1. frontmatter image, 2. cover.jpg/png, 3. first image */ -}}
{{- $coverImage := "" -}}
{{- with .Params.image -}}
  {{- $coverImage = . -}}
{{- else -}}
  {{- /* Try to find cover.jpg or cover.png */ -}}
  {{- with .Resources.GetMatch "cover.{jpg,jpeg,png}" -}}
    {{- $coverImage = .Permalink -}}
  {{- else -}}
    {{- /* Get first image from page resources */ -}}
    {{- $images := .Resources.ByType "image" -}}
    {{- with index $images 0 -}}
      {{- $coverImage = .Permalink -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{ with $coverImage }}
    <meta itemprop="image" property="og:image" class="u-photo" content="{{ . }}">
    <meta name="twitter:card" content="summary_large_image">
{{ else }}
    <meta name="twitter:card" content="summary">
{{ end }}
    <meta property="og:locale" content="{{ replace .Lang "-" "_" }}">
{{ if .Title }}
    <meta itemprop="headline" property="og:title" content="{{ .Title | plainify }}" >
{{ end }}
{{ with .Site.Params.Author.name }}
    <meta itemprop="author" name="author" property="og:author" content="{{ . }}" >
{{ end }}
{{ with .Description }}
    <meta name="description" content="{{ . }}" />
{{ end }}
{{ if or .Description .Summary }}
    <meta property="og:description" content="{{ .Description | default (.Summary | plainify) }}" >
{{ end }}
{{ with .Params.tags }}
    <meta name="keywords" property="og:tags" content="{{ delimit . ", " }}" >
{{ end }}
    <link rel="canonical" href="{{ .Permalink }}">
    <meta property="og:url" content="{{ .Permalink }}" >
    <link rel="webmention" href="https://webmention.io/shadura.me/webmention" />
    <link rel="pingback" href="https://webmention.io/shadura.me/xmlrpc" />
{{ end }}

{{ define "opengraph_type" }}
    <meta property="og:type" content="article">
{{ end }}

{{ define "extra_meta" }}
    <link rel="webmention" href="https://webmention.io/shadura.me/webmention" />
    <link rel="pingback" href="https://webmention.io/shadura.me/xmlrpc" />
{{ end }}

{{ define "content" }}
<article id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="{{ .Permalink }}" rel="bookmark" class="p-name"
         title="Permalink to {{ .Title | plainify }}">{{ .Title }}</a></h2>
    <time class="published dt-published" title="Published on {{ .Date.Format "2 January 2006" }}" datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
      {{ .Date.Format "2 January 2006" }}
    </time>
    {{ with .Lastmod }}
    {{ if ne $.Date . }}
    Â·
    Amended on <time class="modified dt-updated" title="Amended on {{ .Format "2 January 2006" }}" datetime="{{ .Format "2006-01-02T15:04:05Z07:00" }}">
      {{ .Format "2 January 2006" }}
    </time>
    {{ end }}
    {{ end }}
    {{ with $.Site.Params.author.name }}
    <address class="h-card vcard author">
      By <a class="p-name u-url url fn" href="{{ $.Site.Params.author_full_url }}">{{ . }}</a>
    </address>
    {{ end }}
  </header>
  <div class="entry-content e-content">
    {{ .Content }}
  </div><!-- /.entry-content -->
  <footer class="post-info">
    {{ with .Params.categories }}
    <div class="category">
        Category:
        {{ if reflect.IsSlice . }}
          {{ range . }}
          <a href="{{ "/categories/" | relURL }}{{ . | urlize }}">{{ . }}</a>
          {{ end }}
        {{ else }}
          <a href="{{ "/categories/" | relURL }}{{ . | urlize }}">{{ . }}</a>
        {{ end }}
    </div>
    {{ end }}
    {{ with .Params.tags }}
    <div class="tags">
        Tags:
        {{ if reflect.IsSlice . }}
          {{ range . }}
            <a href="{{ "/tags/" | relURL }}{{ . | urlize }}">{{ . }}</a>
          {{ end }}
        {{ else }}
            <a href="{{ "/tags/" | relURL }}{{ . | urlize }}">{{ . }}</a>
        {{ end }}
    </div>
    {{ end }}
    <div class="share">
        Share:
        <a href="https://www.facebook.com/sharer/sharer.php?u={{ .Permalink | urlquery }}&amp;display=popup&amp;ref=plugin&amp;src=like" class="btn btn-xs btn-share" role="button">Facebook</a>
    </div>
  </footer><!-- /.post-info -->
</article>

{{ partial "disqus.html" . }}
{{ end }}
