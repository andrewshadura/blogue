{{- $pctx := . -}}
{{- if .IsHome -}}{{ $pctx = .Site }}{{- end -}}
{{- $pages := slice -}}
{{- if or $.IsHome $.IsSection -}}
{{- $pages = $pctx.RegularPages -}}
{{- else -}}
{{- $pages = $pctx.Pages -}}
{{- end -}}
{{- $limit := .Site.Config.Services.RSS.Limit -}}
{{- if ge $limit 1 -}}
{{- $pages = $pages | first $limit -}}
{{- end -}}
{{- printf "<?xml version=\"1.0\" encoding=\"utf-8\"?>" | safeHTML }}
<feed xmlns="http://www.w3.org/2005/Atom" xmlns:activity="http://activitystrea.ms/spec/1.0/">
  <title>{{ $.Site.Title }}</title>
  <link href="{{ $.Site.Home.Permalink }}" rel="alternate"/>
  <link href="https://bridgy-fed.superfeedr.com/" rel="hub"/>
  <link href="{{ with $.OutputFormats.Get "atom" }}{{ .Permalink }}{{ end }}" rel="self"/>
  <id>{{ $.Site.Home.Permalink | strings.TrimSuffix "/" }}/</id>
  {{- with $pages }}
  {{- with index . 0 }}
  <updated>{{ .Date.Format "2006-01-02T15:04:05-07:00" }}</updated>
  {{- end }}
  {{- end }}
  <author>
    <activity:object-type>http://activitystrea.ms/schema/1.0/person</activity:object-type>
    <name>{{ $.Site.Params.Author.name }}</name>
    <uri>{{ $.Site.Params.Author.url }}</uri>
  </author>
  {{- range $pages }}
  <entry>
    <title>{{ .Title }}</title>
    <link href="{{ .Permalink }}" rel="alternate"/>
    <published>{{ .Date.Format "2006-01-02T15:04:05-07:00" }}</published>
    <updated>{{ .Lastmod.Format "2006-01-02T15:04:05-07:00" }}</updated>
    <author>
      <name>{{ $.Site.Params.Author.name }}</name>
      <uri>{{ $.Site.Params.Author.url }}</uri>
    </author>
    <id>tag:{{ replace $.Site.BaseURL "https://" "" | replaceRE "/$" "" }},{{ .Date.Format "2006-01-02" }}:{{ .RelPermalink }}</id>
    <summary type="html">{{ .Summary | html }}</summary>
    <content type="html">{{ .Content | html }}</content>
    <activity:verb>http://activitystrea.ms/schema/1.0/post</activity:verb>
    <activity:object-type>http://activitystrea.ms/schema/1.0/article</activity:object-type>
  </entry>
  {{- end }}
</feed>
